#!/bin/bash
# scripts/quick_test.sh - Teste r√°pido de conectividade

if [ "$EUID" -ne 0 ]; then
    echo "‚ùå Error: Please run as root (sudo)"
    exit 1
fi

echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë  Quick Network Test                            ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo ""

# Verifica se namespaces existem
if ! ip netns list | grep -q "node1"; then
    echo "‚ùå Namespaces not found. Run setup first:"
    echo "   sudo ./scripts/setup_dev_network.sh"
    exit 1
fi

echo "‚úÖ Namespaces found"
echo ""

# Teste de conectividade
echo "üîç Testing connectivity..."
echo ""

for i in 1 2 3 4; do
    for j in 1 2 3 4; do
        if [ $i -ne $j ]; then
            IP="192.168.2.$((10+j))"
            echo -n "   node$i ‚Üí node$j ($IP): "
            
            if ip netns exec node$i ping -c 1 -W 1 $IP > /dev/null 2>&1; then
                echo "‚úÖ OK"
            else
                echo "‚ùå FAIL"
            fi
        fi
    done
done

echo ""
echo "üîç Checking ARP tables..."
echo ""

for i in 1 2 3 4; do
    echo "Node $i ARP table:"
    ip netns exec node$i arp -n | grep -v "Address"
    echo ""
done

echo "‚úÖ Test complete"